# FADO CRM Lint & Type-Checking Roadmap\n\nGoal: keep code stable, readable, and CI-green while gradually tightening standards without blocking delivery.\n\n## Current baseline\n- Formatter: Black (line-length 100), isort (black profile)\n- Linter: Flake8 with relaxed rules to minimize noise\n- CI: Lint + tests required on protected branches\n\n## Phase 1 — Consolidate formatting & import hygiene (Now)\n- Enforce Black + isort via pre-commit hooks\n- Flake8: enable selected rules that catch real issues (e.g., F401 unused imports, F841 unused vars, E9 syntax errors)\n- Add `tox` or `nox` to standardize local runs (optional)\n\nSuccess criteria:\n- Pre-commit prevents bad imports and formatting diffs\n- CI stays green consistently\n\n## Phase 2 — Gradual typing adoption\n- Introduce mypy (start permissive): `disallow_untyped_defs = False`, strict only in selected modules\n- Annotate modules with highest churn/risk first (e.g., `backend/performance_monitor.py`, service layers)\n- Add `typing_extensions` if needed for backports\n\nSuccess criteria:\n- mypy runs in CI, limited to a whitelist of modules\n- New/changed code in those modules must be typed\n\n## Phase 3 — Security linting\n- Add Bandit with a curated profile, fail only on high-severity findings initially\n- Add `pip-audit` (or `safety`) as an allowlist-gated job to prevent accidental dependency vulns\n\nSuccess criteria:\n- No high-severity Bandit findings in CI\n- Periodic dependency audit is visible in PRs\n\n## Phase 4 — Move to Ruff (optional, recommended)\n- Adopt Ruff to unify pyflakes/pycodestyle/isort in one fast engine\n- Mirror current rules, then incrementally enable more (e.g., `SIM`, `PERF`)\n\nSuccess criteria:\n- Lint time drops significantly\n- Rule-set parity with previous tools, plus gradual tightening\n\n## Phase 5 — Test quality gates\n- Enforce minimum test coverage threshold (start low, e.g., 60%)\n- Add mutation testing on a small critical subset (optional)\n\nSuccess criteria:\n- Stable coverage trend, no flaky failures introduced by gates\n\n## Tooling snippets\n\nExample pre-commit config (excerpt):\n\n```yaml\nrepos:\n  - repo: https://github.com/psf/black\n    rev: 24.8.0\n    hooks:\n      - id: black\n        args: ["--line-length=100"]\n  - repo: https://github.com/pycqa/isort\n    rev: 5.13.2\n    hooks:\n      - id: isort\n        args: ["--profile=black", "--line-length=100"]\n  - repo: https://github.com/charliermarsh/ruff-pre-commit\n    rev: v0.6.0\n    hooks:\n      - id: ruff\n        args: ["--fix"]\n```\n\nmypy (initial `mypy.ini`):\n\n```ini\n[mypy]\npython_version = 3.11\nwarn_unused_ignores = True\nwarn_redundant_casts = True\nno_site_packages = True\n# Start focused and expand\nfiles = backend/performance_monitor.py, backend/services/**/*.py\n```\n\n## Rollout plan\n- Apply phases 1–2 immediately on active modules; schedule phases 3–5 over 2–3 sprints\n- Document any newly enabled rules in PR descriptions\n\n## Ownership\n- Code Owners: Backend team\n- Approvers: Tech Lead\n\n## Risks & mitigations\n- Risk: noisy CI. Mitigation: stage rules behind allowlists; communicate in PR templates.\n- Risk: developer friction. Mitigation: pre-commit + fast linters (Ruff), clear autofix paths.\n