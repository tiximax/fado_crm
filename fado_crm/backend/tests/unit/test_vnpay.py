# Tests for VNPay helper from integrations.payment.vnpay import sign_params, verify_signature, build_payment_url def test_vnpay_sign_and_verify(): secret = "test_secret" params = { "vnp_Version": "2.1.0", "vnp_Command": "pay", "vnp_TmnCode": "TESTCODE", "vnp_Amount": 10000, "vnp_CurrCode": "VND", "vnp_TxnRef": "VNP250101000001", "vnp_OrderInfo": "FADO Test", } sig = sign_params(params, secret) assert isinstance(sig, str) and len(sig) == 128 # sha512 hex # verify should succeed with same secret q = dict(params) q["vnp_SecureHash"] = sig assert verify_signature(q, secret) is True def test_build_payment_url_includes_signature(): secret = "test_secret" params = { "vnp_Version": "2.1.0", "vnp_TmnCode": "TEST", "vnp_TxnRef": "VNPREF", } url = build_payment_url(params, secret, "https://sandbox.vnpayment.vn/paymentv2/vpcpay.html") assert "vnp_SecureHash=" in url
